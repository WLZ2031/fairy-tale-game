<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç¶“å…¸ç«¥è©±æ•…äº‹æ’åºéŠæˆ²</title>

<script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

<style>
  body { 
    font-family: "Microsoft JhengHei", Arial, sans-serif; 
    text-align: center; 
    background: #f0f9fa; 
    margin: 0; padding: 0; 
    height: 100vh; width: 100vw;
    overflow: hidden;
    display: flex; flex-direction: column;
  }

  /* è¿”å›æŒ‰éˆ• */
  .back-arrow {
    position: absolute; top: 12px; left: 12px; width: 40px; height: 40px;
    background: white; border: 3px solid #000; border-radius: 50%;
    display: none; align-items: center; justify-content: center;
    cursor: pointer; z-index: 100; font-size: 22px; color: #000; font-weight: 900;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  /* å³ä¸ŠåŠŸèƒ½æŒ‰éˆ• */
  .top-right-controls {
    position: absolute; top: 12px; right: 12px; 
    display: none; gap: 8px; z-index: 100;
  }
  .icon-btn {
    width: 40px; height: 40px; border-radius: 50%; border: none;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 20px; box-shadow: 0 3px 8px rgba(0,0,0,0.15); transition: 0.2s;
  }
  #toggleLayout { background: #546e7a; color: white; }
  #retry { background: #ffa000; color: white; }
  #check { background: #00bfa5; color: white; }
  .icon-btn:active { transform: scale(0.95); }

  /* éŠæˆ²ä¸»å®¹å™¨ */
  .game-wrapper { 
    display: none; 
    height: 100vh; width: 100vw;
    flex-direction: column; 
  }

  /* 
     === 1. ä¸Šæ–¹ç›®æ¨™å€ (60%) === 
  */
  .game-wrapper:not(.layout-mode-2x2) .panel-target {
    flex: 6;  
    order: 1; 
    background: #e0f2f1; 
    border-bottom: 2px solid #b2ebf2;
    display: flex;
    justify-content: center; 
    align-items: center; /* å‚ç›´ç½®ä¸­ */
    padding: 10px 5px;   /* å¢åŠ å°‘é‡å…§è·ä½œç‚ºå®‰å…¨é‚Šç•Œ */
  }
  
  /* 
     === 2. ä¸‹æ–¹åœ–åº«å€ (40%) === 
  */
  .game-wrapper:not(.layout-mode-2x2) .panel-source {
    flex: 4;  
    order: 2; 
    background: #ffffff; 
    border-top: none;
    display: flex;
    justify-content: center; 
    align-items: flex-start; /* é ä¸Šå°é½Š (è²¼è¿‘ä¸­é–“) */
    padding: 15px 5px 5px 5px; /* ä¸Šæ–¹ç•™é–“éš™ï¼Œå·¦å³ç•™å®‰å…¨é‚Šç•Œ */
  }

  /* 
     === ç¶²æ ¼ç³»çµ± (é€šç”¨) === 
  */
  .grid-layout { 
    display: grid; 
    grid-template-columns: repeat(4, 1fr); 
    gap: 12px; /* ç¨å¾®ç¸®å°é–“è·ï¼ŒæŠŠç©ºé–“ç•™çµ¦åœ–ç‰‡ */
    width: 98%; /* ç›¡é‡ä½”æ»¿å¯¬åº¦ */
    max-width: 1400px;
    height: 100%; /* é«˜åº¦è·Ÿéš¨çˆ¶å®¹å™¨ */
    align-content: center; /* å…§å®¹ç½®ä¸­ */
    transition: all 0.3s ease;
  }

  /* 
     === åœ–ç‰‡èˆ‡æ ¼å­å°ºå¯¸æ§åˆ¶ (æ ¸å¿ƒä¿®æ”¹) === 
     ç›®æ¨™ï¼šå¤§åœ–ã€ä¸è£åˆ‡ã€ä¿æŒæ­£æ–¹å½¢
  */
  
  /* ä¸‹æ–¹ä¾†æºåœ–ç‰‡ */
  #source img { 
    width: 100%;  
    aspect-ratio: 1 / 1; 
    object-fit: cover; 
    border-radius: 12px; 
    box-sizing: border-box;
    cursor: grab; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.12); 
    touch-action: none; 
    background: #fff; 
    
    /* é›™é‡é™åˆ¶ï¼š
       1. é«˜åº¦ä¸èƒ½è¶…é 35% çš„è¦–çª—é«˜åº¦ (å‚ç›´é™åˆ¶)
       2. å¯¬åº¦è‡ªå‹•éš¨ç¶²æ ¼ç¸®æ”¾ (æ°´å¹³é™åˆ¶)
       é€™èƒ½ç¢ºä¿åœ¨å¯¬è¢å¹•å’Œçª„è¢å¹•éƒ½å®‰å…¨é¡¯ç¤º */
    max-height: 35vh; 
    
    justify-self: center; 
    align-self: flex-start; /* ç¢ºä¿è²¼è¿‘ä¸Šæ–¹é‚Šç·£ */
  }

  /* ä¸Šæ–¹æ ¼å­ */
  .slot { 
    width: 100%; 
    aspect-ratio: 1 / 1; 
    background: #f8fdff; 
    border: 3px dashed #b2ebf2; 
    box-sizing: border-box; 
    border-radius: 15px; 
    display: flex; align-items: center; justify-content: center; position: relative;
    overflow: visible; 
    
    /* æ ¼å­æœ€å¤§é«˜åº¦é™åˆ¶ï¼š
       ç¢ºä¿åœ¨ 60% çš„å€åŸŸå…§ï¼Œæ‰£é™¤æ¨™é¡Œåˆ—æˆ–é‚Šè·å¾Œä¸æº¢å‡º */
    max-height: 55vh; 
    
    justify-self: center;
  }

  /* æ”¾å…¥æ ¼å­å¾Œçš„åœ–ç‰‡ */
  .slot img { 
    width: 100% !important; 
    height: 100% !important; 
    object-fit: cover; 
    border-radius: 12px; 
    margin: 0; padding: 0; display: block;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative; z-index: 1; 
  }

  @keyframes popIn {
    0% { transform: scale(0.9); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }

  /* æ•¸å­—æ¨™ç±¤ */
  .number { 
    position: absolute; 
    top: -18px; 
    left: 50%; transform: translateX(-50%);
    background: white; 
    width: 28px; height: 28px; 
    border-radius: 50%; 
    font-size: 16px; font-weight: 900; color: #00838f;
    display: flex; align-items: center; justify-content: center; 
    border: 2px solid #b2ebf2;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
    z-index: 10; 
  }

  /* 
     === åª’é«”æŸ¥è©¢ï¼šé‡å°å¯¬é«˜æ¯”æ¥µç«¯çš„è¨­å‚™å„ªåŒ– === 
  */

  /* 1. å¹³æ¿/å¯¬è¢å¹•æ‰‹æ©Ÿ (æ©«å‘ç©ºé–“è¶³å¤ ) */
  @media (min-aspect-ratio: 4/3) {
    .grid-layout {
      gap: 20px; /* ç©ºé–“å¤ ï¼Œé–“è·åŠ å¤§ */
    }
  }

  /* 2. æ‰‹æ©Ÿ/çª„è¢å¹• (ç›´å‘ï¼Œå¯¬åº¦æ˜¯ç“¶é ¸) */
  @media (max-aspect-ratio: 1/1) {
    /* åœ¨çª„è¢å¹•ä¸Šï¼Œå¯¬åº¦æ±ºå®šé«˜åº¦ã€‚
       ç‚ºäº†é˜²æ­¢ 1x4 æ’åˆ—æ™‚åœ–ç‰‡å¤ªå°ï¼Œæˆ‘å€‘å¯ä»¥é©åº¦ç¸®å°é–“è· */
    .grid-layout {
      gap: 8px; 
      width: 98%;
    }
    
    /* èª¿æ•´æ•¸å­—çƒå¤§å°ï¼Œé¿å…é®æ“‹å¤ªå¤š */
    .number {
      width: 24px; height: 24px; font-size: 14px; top: -14px;
    }
    
    /* é‡å°éå¸¸çª„çš„æ‰‹æ©Ÿï¼Œå¯èƒ½éœ€è¦å¼·åˆ¶åˆ‡æ›ä½ˆå±€ (é€™è£¡ä¿æŒæ‚¨è¦æ±‚çš„ 1x4 å„ªå…ˆï¼Œä½†åœ¨ JS å¯æ§åˆ¶) */
  }

  /* 
     === 2x2 æ¨¡å¼ (æ©«å‘æ’åˆ—) === 
  */
  .game-wrapper.layout-mode-2x2 { flex-direction: row; }
  .game-wrapper.layout-mode-2x2 .panel {
    flex: 1; height: 100%; border-bottom: none; padding: 10px; order: 0; align-items: center; 
  }
  .game-wrapper.layout-mode-2x2 .panel-source { order: 0; border-right: 2px solid #e0f2f1; padding-top: 0; }
  .game-wrapper.layout-mode-2x2 .panel-target { order: 1; padding-bottom: 0; }
  .game-wrapper.layout-mode-2x2 .grid-layout {
    grid-template-columns: repeat(2, 1fr); width: 92%; gap: 15px; 
  }
  .game-wrapper.layout-mode-2x2 #source img, 
  .game-wrapper.layout-mode-2x2 .slot { max-height: 40vh; } /* 2x2 é™åˆ¶é«˜åº¦ */


  /* æ‰‹æ©Ÿç›´å‘å¼·åˆ¶é©é… (å¦‚æœè¢å¹•å¤ªçª„ï¼Œå¼·åˆ¶åˆ‡æ›æˆ 2x2 æˆ–å„ªåŒ– 1x4) */
  @media (max-width: 600px) and (orientation: portrait) {
    /* é€™è£¡ä¿æŒ 1x4 çµæ§‹ï¼Œä½†åˆ©ç”¨ CSS Grid ç¢ºä¿ä¸æº¢å‡º */
    .game-wrapper:not(.layout-mode-2x2) .grid-layout {
        /* å¦‚æœ 4 å€‹æ©«æ’å¤ªæ“ ï¼Œå¯ä»¥è®“å®ƒè‡ªå‹•ç¸®å° */
        width: 100%; 
        padding: 0 5px;
        box-sizing: border-box;
    }
  }

  /* è¨Šæ¯æç¤º */
  .message { 
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 40px; font-weight: bold; pointer-events: none; z-index: 200;
    text-shadow: 0 4px 10px rgba(255,255,255,0.9); width: 100%;
  }
  .correct { color: #00c853; }
  .wrong { color: #d50000; }

  /* ç›®éŒ„é  */
  .menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 40px 20px; overflow-y: auto; height: 100vh; box-sizing: border-box; }
  .story-btn { width: 140px; background: white; border-radius: 20px; padding: 10px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: transform 0.2s; }
  .story-btn:active { transform: scale(0.95); }
  .story-btn img { width: 100%; height: 90px; object-fit: cover; border-radius: 12px; }
  .story-btn span { display: block; margin-top: 8px; font-weight: bold; color: #006064; font-size: 14px; }
</style>
</head>
<body>

<button class="back-arrow" id="backBtn">â†</button>

<div class="top-right-controls" id="controls">
  <button id="toggleLayout" class="icon-btn" title="åˆ‡æ›ä½ˆå±€">ğŸ”„</button>
  <button id="retry" class="icon-btn" title="å†ç©ä¸€æ¬¡">ğŸ•’</button>
  <button id="check" class="icon-btn" title="æª¢æŸ¥ç­”æ¡ˆ">âœ…</button>
</div>

<div class="menu" id="menu"></div>

<div id="game" class="game-wrapper">
  <!-- ä¾†æºå€ -->
  <div class="panel panel-source">
    <div id="source" class="grid-layout"></div>
  </div>
  <!-- ç›®æ¨™å€ -->
  <div class="panel panel-target">
    <div id="targetGrid" class="grid-layout">
      <div class="slot"><div class="number">1</div></div>
      <div class="slot"><div class="number">2</div></div>
      <div class="slot"><div class="number">3</div></div>
      <div class="slot"><div class="number">4</div></div>
    </div>
  </div>
  <div class="message" id="message"></div>
</div>

<script>
const sounds = {
  click: new Audio("audio/card-sounds-35956.mp3"),
  drop: new Audio("audio/card-sounds-35956.mp3"),
  success: new Audio("audio/Well Done CCBY3.ogg"),
  error: new Audio("audio/total fail.ogg")
};

const stories = {
  pigs: { name: "ä¸‰éš»å°è±¬", imgs: ["pigs0.jpg","pigs1.jpg","pigs2.jpg","pigs3.jpg","pigs4.jpg"], correct: [1,2,3,4] },
  redhood: { name: "å°ç´…å¸½", imgs: ["red0.jpg","red1.jpg","red2.jpg","red3.jpg","red4.jpg"], correct: [1,2,3,4] },
  bear: { name: "å°ç†Šæ‹”ç‰™", imgs: ["bear0.jpg","bear1.jpg","bear2.jpg","bear3.jpg","bear4.jpg"], correct: [1,2,3,4] },
  squirrel: { name: "æ¾é¼ éé¦¬è·¯", imgs: ["squirrel0.jpg","squirrel1.jpg","squirrel2.jpg","squirrel3.jpg","squirrel4.jpg"], correct: [1,2,3,4] },
  wolf: { name: "ç‹¼ä¾†äº†", imgs: ["wolf0.jpg","wolf1.jpg","wolf2.jpg","wolf3.jpg","wolf4.jpg"], correct: [1,2,3,4] },
  race: { name: "é¾œå…”è³½è·‘", imgs: ["race0.jpg","race1.jpg","race2.jpg","race3.jpg","race4.jpg"], correct: [1,2,3,4] },
  honey: { name: "ç†Šåˆ†äº«èœœç³–", imgs: ["honey0.jpg","honey1.jpg","honey2.jpg","honey3.jpg","honey4.jpg"], correct: [1,2,3,4] },
  crow: { name: "çƒé´‰å–æ°´", imgs: ["crow0.jpg","crow1.jpg","crow2.jpg","crow3.jpg","crow4.jpg"], correct: [1,2,3,4] },
  dog: { name: "è²ªå¿ƒçš„å°ç‹—", imgs: ["dog0.jpg","dog1.jpg","dog2.jpg","dog3.jpg","dog4.jpg"], correct: [1,2,3,4] }
};

let currentStory = null;
const backBtn = document.getElementById('backBtn');
const controls = document.getElementById('controls');
const gameWrapper = document.getElementById('game');
let draggedItem = null; 

function playSound(name) { if (sounds[name]) { sounds[name].currentTime = 0; sounds[name].play().catch(e => {}); } }

function renderMenu() {
  const menu = document.getElementById('menu');
  menu.innerHTML = '';
  backBtn.style.display = 'none';
  controls.style.display = 'none';
  for (let key in stories) {
    const btn = document.createElement('div');
    btn.className = 'story-btn';
    btn.innerHTML = `<img src="${stories[key].imgs[0]}"><span>${stories[key].name}</span>`;
    btn.onclick = () => startGame(stories[key]);
    menu.appendChild(btn);
  }
}

function startGame(story) {
  currentStory = story;
  playSound('click');
  document.getElementById('menu').style.display = 'none';
  gameWrapper.style.display = 'flex'; 
  backBtn.style.display = 'flex';
  controls.style.display = 'flex';
  document.getElementById('message').textContent = '';
  
  gameWrapper.classList.remove('layout-mode-2x2'); 

  const indices = [1, 2, 3, 4];
  shuffle(indices);
  const source = document.getElementById('source');
  source.innerHTML = '';
  indices.forEach(i => {
    const img = createDraggableImage(story.imgs[i], i);
    source.appendChild(img);
  });
  document.querySelectorAll('.slot').forEach(slot => {
    const num = slot.querySelector('.number');
    slot.innerHTML = '';
    slot.appendChild(num);
  });
  
  setupDropZones();
}

function createDraggableImage(src, index) {
  const img = document.createElement('img');
  img.src = src;
  img.draggable = true;
  img.dataset.index = index;
  
  img.ondragstart = (e) => {
    draggedItem = img;
    e.dataTransfer.setData('index', img.dataset.index);
    e.dataTransfer.effectAllowed = "move";
  };
  
  img.onclick = function() {
      if (this.parentElement.classList.contains('slot')) {
          playSound('click');
          const source = document.getElementById('source');
          source.appendChild(this);
      }
  };

  return img;
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function setupDropZones() {
  document.querySelectorAll('.slot').forEach(slot => {
    slot.ondragover = e => {
      e.preventDefault(); 
      e.dataTransfer.dropEffect = "move";
    };

    slot.ondrop = e => {
      e.preventDefault();
      if (!draggedItem) return;

      playSound('drop');
      const existingImg = slot.querySelector('img');
      const oldParent = draggedItem.parentElement;

      if (!existingImg) {
        slot.appendChild(draggedItem);
      } 
      else if (existingImg && existingImg !== draggedItem) {
        if (oldParent.classList.contains('slot')) {
           oldParent.appendChild(existingImg);
           slot.appendChild(draggedItem);
        } else {
           document.getElementById('source').appendChild(existingImg);
           slot.appendChild(draggedItem);
        }
      }
      draggedItem = null; 
    };
  });

  const sourceZone = document.getElementById('source');
  sourceZone.ondragover = e => {
    e.preventDefault();
    e.dataTransfer.dropEffect = "move";
  };
  sourceZone.ondrop = e => {
    e.preventDefault();
    if (!draggedItem) return;
    
    if (draggedItem.parentElement !== sourceZone) {
      playSound('drop');
      sourceZone.appendChild(draggedItem);
    }
    draggedItem = null;
  };
}

document.getElementById('check').onclick = () => {
  const ans = Array.from(document.querySelectorAll('.slot img')).map(img => parseInt(img.dataset.index));
  const msg = document.getElementById('message');
  if (ans.length < 4) { playSound('error'); msg.textContent = 'âš ï¸ æœªå®Œæˆ'; msg.className='message wrong'; return; }
  if (JSON.stringify(ans) === JSON.stringify(currentStory.correct)) {
    playSound('success'); msg.textContent = 'ğŸŒŸ æ­£ç¢ºï¼'; msg.className='message correct';
  } else {
    playSound('error'); msg.textContent = 'âŒ éŒ¯èª¤ï¼'; msg.className='message wrong';
  }
  setTimeout(() => msg.textContent = '', 2000);
};

document.getElementById('retry').onclick = () => startGame(currentStory);

document.getElementById('toggleLayout').onclick = () => {
  playSound('click');
  gameWrapper.classList.toggle('layout-mode-2x2');
};

backBtn.onclick = () => { 
  document.getElementById('game').style.display = 'none'; 
  document.getElementById('menu').style.display = 'flex'; 
  renderMenu();
};

renderMenu();
</script>
</body>
</html>
