<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç¶“å…¸ç«¥è©±æ•…äº‹æ’åºéŠæˆ²</title>

<script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

<style>
  body { 
    font-family: "Microsoft JhengHei", Arial, sans-serif; 
    text-align: center; 
    background: #f0f9fa; 
    margin: 0; padding: 0; 
    height: 100vh; width: 100vw;
    overflow: hidden;
  }

  /* è¿”å›æŒ‰éˆ•ï¼šå·¦ä¸Šè§’é»‘è‰²åŠ ç²— */
  .back-arrow {
    position: absolute; top: 10px; left: 10px; width: 40px; height: 40px;
    background: white; border: 3px solid #000; border-radius: 50%;
    display: none; align-items: center; justify-content: center;
    cursor: pointer; z-index: 100; font-size: 24px; color: #000; font-weight: 900;
  }

  /* å³ä¸Šæ–¹åŠŸèƒ½æŒ‰éˆ•çµ„ */
  .top-right-controls {
    position: absolute; top: 10px; right: 10px; 
    display: none; flex-direction: row; gap: 10px; z-index: 100;
  }
  .icon-btn {
    width: 45px; height: 45px; border-radius: 50%; border: none;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s;
  }
  #check { background: #00bfa5; color: white; } 
  #retry { background: #ffa000; color: white; } 
  #toggleLayout { background: #546e7a; color: white; }

  /* éŠæˆ²ä¸»é«” */
  .game-wrapper { 
    display: none; height: 100vh; width: 100vw; 
    flex-direction: column; 
  }

  .game-main { 
    display: flex; flex: 1; width: 100%; height: 100%;
    flex-direction: column; /* é è¨­ç‚ºä¸Šä¸‹æ’åˆ— */
  }

  .panel {
    flex: 1; display: flex; align-items: center; justify-content: center;
    padding: 10px; box-sizing: border-box; width: 100%;
  }

  /* æ ¸å¿ƒä¿®æ”¹ï¼šå¼·åˆ¶ 1x4 æ©«å‘æ’åˆ—ï¼Œç¢ºä¿æ ¼å­èˆ‡åœ–ç‰‡å¤§å°ä¸€è‡´ */
  .grid-layout { 
    display: grid; 
    grid-template-columns: repeat(4, 1fr); /* æ©«å‘ 4 æ ¼ */
    gap: 12px; 
    width: 95%; height: 80%; /* èª¿æ•´é«˜åº¦æ¯”ä¾‹ */
    max-width: 1200px;
  }

  /* åœ–ç‰‡èˆ‡æ ¼å­ï¼šè‡ªé©æ‡‰ */
  #source img, .slot { 
    width: 100%; height: 100%;
    max-height: 40vh;
    object-fit: cover; border-radius: 12px; box-sizing: border-box;
  }

  #source img { cursor: move; box-shadow: 0 4px 10px rgba(0,0,0,0.1); touch-action: none; }
  
  .slot { 
    background: #f8fdff; border: 3px dashed #b2ebf2; 
    display: flex; align-items: center; justify-content: center; position: relative;
  }
  .slot img { width: 100%; height: 100%; object-fit: cover; border-radius: 9px; }

  .number { 
    position: absolute; top: 5px; left: 5px; 
    background: rgba(255,255,255,0.8); width: 22px; height: 22px;
    border-radius: 50%; font-size: 14px; font-weight: bold; color: #00838f;
    display: flex; align-items: center; justify-content: center; z-index: 5;
  }

  /* è¨Šæ¯æç¤º */
  .message { 
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    font-size: 24px; font-weight: bold; pointer-events: none; z-index: 200;
  }
  .correct { color: #00c853; text-shadow: 0 0 10px white; }
  .wrong { color: #d50000; text-shadow: 0 0 10px white; }

  /* ç›®éŒ„é  */
  .menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 20px; overflow-y: auto; }
  .story-btn { width: 150px; background: white; border-radius: 15px; padding: 10px; cursor: pointer; }
  .story-btn img { width: 100%; height: 100px; object-fit: cover; border-radius: 10px; }
  .story-btn span { display: block; margin-top: 5px; font-weight: bold; }

  /* ç•¶åˆ‡æ›ç‚ºå·¦å³ä½ˆå±€æ™‚çš„æ¨£å¼ (Row æ¨¡å¼) */
  .layout-row { flex-direction: row !important; }
  .layout-row .grid-layout { grid-template-columns: repeat(2, 1fr); } /* å·¦å³æ¨¡å¼æ™‚è®Šå› 2x2 */
</style>
</head>
<body>

<button class="back-arrow" id="backBtn">â†</button>

<div class="top-right-controls" id="controls">
  <button id="toggleLayout" class="icon-btn" title="åˆ‡æ›ä½ˆå±€">ğŸ”„</button>
  <button id="retry" class="icon-btn" title="å†ç©ä¸€æ¬¡">ğŸ•’</button>
  <button id="check" class="icon-btn" title="æª¢æŸ¥ç­”æ¡ˆ">âœ…</button>
</div>

<div class="menu" id="menu"></div>

<div id="game" class="game-wrapper">
  <div id="gameMain" class="game-main">
    <div class="panel">
      <div id="source" class="grid-layout"></div>
    </div>

    <div class="panel">
      <div id="targetGrid" class="grid-layout">
        <div class="slot"><div class="number">1</div></div>
        <div class="slot"><div class="number">2</div></div>
        <div class="slot"><div class="number">3</div></div>
        <div class="slot"><div class="number">4</div></div>
      </div>
    </div>
  </div>
  <div class="message" id="message"></div>
</div>

<script>
// æ ¸å¿ƒé‚è¼¯åƒè€ƒè‡ª index.html
const sounds = {
  click: new Audio("audio/card-sounds-35956.mp3"),
  drop: new Audio("audio/card-sounds-35956.mp3"),
  success: new Audio("audio/Well Done CCBY3.ogg"),
  error: new Audio("audio/total fail.ogg")
};

const stories = {
  pigs: { name: "ä¸‰éš»å°è±¬", imgs: ["pigs0.jpg","pigs1.jpg","pigs2.jpg","pigs3.jpg","pigs4.jpg"], correct: [1,2,3,4] },
  redhood: { name: "å°ç´…å¸½", imgs: ["red0.jpg","red1.jpg","red2.jpg","red3.jpg","red4.jpg"], correct: [1,2,3,4] },
  bear: { name: "å°ç†Šæ‹”ç‰™", imgs: ["bear0.jpg","bear1.jpg","bear2.jpg","bear3.jpg","bear4.jpg"], correct: [1,2,3,4] },
  squirrel: { name: "æ¾é¼ éé¦¬è·¯", imgs: ["squirrel0.jpg","squirrel1.jpg","squirrel2.jpg","squirrel3.jpg","squirrel4.jpg"], correct: [1,2,3,4] },
  wolf: { name: "ç‹¼ä¾†äº†", imgs: ["wolf0.jpg","wolf1.jpg","wolf2.jpg","wolf3.jpg","wolf4.jpg"], correct: [1,2,3,4] },
  race: { name: "é¾œå…”è³½è·‘", imgs: ["race0.jpg","race1.jpg","race2.jpg","race3.jpg","race4.jpg"], correct: [1,2,3,4] },
  honey: { name: "ç†Šåˆ†äº«èœœç³–", imgs: ["honey0.jpg","honey1.jpg","honey2.jpg","honey3.jpg","honey4.jpg"], correct: [1,2,3,4] },
  crow: { name: "çƒé´‰å–æ°´", imgs: ["crow0.jpg","crow1.jpg","crow2.jpg","crow3.jpg","crow4.jpg"], correct: [1,2,3,4] },
  dog: { name: "è²ªå¿ƒçš„å°ç‹—", imgs: ["dog0.jpg","dog1.jpg","dog2.jpg","dog3.jpg","dog4.jpg"], correct: [1,2,3,4] }
};

let currentStory = null;
const backBtn = document.getElementById('backBtn');
const controls = document.getElementById('controls');

function playSound(name) { if (sounds[name]) { sounds[name].currentTime = 0; sounds[name].play().catch(e => {}); } }

function renderMenu() {
  const menu = document.getElementById('menu');
  menu.innerHTML = '';
  backBtn.style.display = 'none';
  controls.style.display = 'none';
  for (let key in stories) {
    const btn = document.createElement('div');
    btn.className = 'story-btn';
    btn.innerHTML = `<img src="${stories[key].imgs[0]}"><span>${stories[key].name}</span>`;
    btn.onclick = () => startGame(stories[key]);
    menu.appendChild(btn);
  }
}

function startGame(story) {
  currentStory = story;
  playSound('click');
  document.getElementById('menu').style.display = 'none';
  document.getElementById('game').style.display = 'flex';
  backBtn.style.display = 'flex';
  controls.style.display = 'flex';
  document.getElementById('message').textContent = '';
  
  const indices = [1, 2, 3, 4];
  for (let i = indices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  
  const source = document.getElementById('source');
  source.innerHTML = '';
  indices.forEach(i => {
    const img = document.createElement('img');
    img.src = story.imgs[i];
    img.draggable = true;
    img.dataset.index = i;
    source.appendChild(img);
  });
  
  document.querySelectorAll('.slot').forEach(slot => {
    const num = slot.querySelector('.number');
    slot.innerHTML = '';
    slot.appendChild(num);
  });
  setupEvents();
}

function setupEvents() {
  document.querySelectorAll('#source img').forEach(img => {
    img.ondragstart = e => e.dataTransfer.setData('index', img.dataset.index);
  });
  document.querySelectorAll('.slot').forEach(slot => {
    slot.ondragover = e => e.preventDefault();
    slot.ondrop = e => {
      e.preventDefault();
      const idx = e.dataTransfer.getData('index');
      const draggedImg = document.querySelector(`#source img[data-index="${idx}"]`) || document.querySelector(`.slot img[data-index="${idx}"]`);
      if (draggedImg) {
        playSound('drop');
        const existing = slot.querySelector('img');
        if (existing) document.getElementById('source').appendChild(existing);
        const newImg = draggedImg.cloneNode();
        newImg.dataset.index = idx;
        slot.appendChild(newImg);
        if (draggedImg.parentElement.id === 'source') draggedImg.remove();
        setupEvents();
      }
    };
    slot.onclick = function() {
      const img = this.querySelector('img');
      if (img) {
        playSound('click');
        const returned = img.cloneNode();
        returned.dataset.index = img.dataset.index;
        document.getElementById('source').appendChild(returned);
        img.remove();
        setupEvents();
      }
    };
  });
}

document.getElementById('check').onclick = () => {
  const ans = Array.from(document.querySelectorAll('.slot img')).map(img => parseInt(img.dataset.index));
  const msg = document.getElementById('message');
  if (ans.length < 4) { playSound('error'); msg.textContent = 'âš ï¸ æœªå®Œæˆ'; msg.className='message wrong'; return; }
  if (JSON.stringify(ans) === JSON.stringify(currentStory.correct)) {
    playSound('success'); msg.textContent = 'ğŸŒŸ æ­£ç¢ºï¼'; msg.className='message correct';
  } else {
    playSound('error'); msg.textContent = 'âŒ éŒ¯èª¤ï¼'; msg.className='message wrong';
  }
  setTimeout(() => msg.textContent = '', 2000);
};

document.getElementById('retry').onclick = () => startGame(currentStory);

document.getElementById('toggleLayout').onclick = () => {
  playSound('click');
  const main = document.getElementById('gameMain');
  main.classList.toggle('layout-row'); // åœ¨ã€Œä¸Šä¸‹æ’åˆ—ã€èˆ‡ã€Œå·¦å³åˆ†æ¬„ã€é–“åˆ‡æ›
};

backBtn.onclick = () => { 
  document.getElementById('game').style.display = 'none'; 
  document.getElementById('menu').style.display = 'flex'; 
  renderMenu();
};

renderMenu();
</script>
</body>
</html>