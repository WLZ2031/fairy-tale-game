<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç¶“å…¸ç«¥è©±æ•…äº‹æ’åºéŠæˆ²</title>

<script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

<style>
  body { 
    font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif; 
    text-align: center; 
    background: linear-gradient(to bottom, #e9f6f8, #ffffff); 
    margin: 0; padding: 10px; min-height: 100vh;
    overflow-x: hidden;
  }
  
  h1 { color: #006064; margin: 10px 0; font-size: 1.8rem; }
  
  .game-wrapper { display: none; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.5s; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  /* æ ¸å¿ƒä½ˆå±€æ§åˆ¶ */
  .game-main { 
    display: flex; 
    gap: 20px; 
    justify-content: center; 
    align-items: flex-start;
    transition: all 0.3s ease;
  }

  /* --- æ¨¡å¼ 1: å·¦å³æ’åˆ— (2x2) --- */
  .layout-side-by-side { flex-direction: row; }
  .layout-side-by-side #source { grid-template-columns: repeat(2, 1fr); } 
  .layout-side-by-side .positions { grid-template-columns: repeat(2, 1fr); } 

  /* --- æ¨¡å¼ 2: ä¸Šä¸‹æ’åˆ— (å…¨éƒ¨æ‰“æ©« 1x4) --- */
  .layout-stacked { flex-direction: column; align-items: center; }
  /* ä¸Šæ–¹ç´ æå€æ”¹ç‚ºæ©«å‘ä¸€æ’ */
  .layout-stacked #source { grid-template-columns: repeat(4, 1fr); width: auto; } 
  /* ä¸‹æ–¹æ’åºå€æ”¹ç‚ºæ©«å‘ä¸€æ’ */
  .layout-stacked .positions { grid-template-columns: repeat(4, 1fr); } 
  .layout-stacked .panel { width: 95%; max-width: 900px; margin-bottom: 15px; }

  .panel {
    background: white; padding: 20px; border-radius: 24px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    display: flex; flex-direction: column; align-items: center;
  }

  .panel-title { font-size: 18px; color: #006064; margin-bottom: 5px; font-weight: bold; }
  .panel-tip { font-size: 13px; color: #78909c; margin-bottom: 15px; }
  
  .grid-layout { display: grid; gap: 12px; transition: all 0.3s; }

  #source img, .slot img { 
    width: 140px; height: 130px; 
    object-fit: cover; border-radius: 12px; 
    -webkit-user-drag: element;
    touch-action: none; 
    user-select: none;
  }

  #source img { cursor: move; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
  .dragging { opacity: 0.5; transform: scale(1.05); }

  .slot-wrapper { position: relative; padding-top: 30px; }
  .slot { 
    width: 140px; height: 130px; background: #f0fbff; 
    border: 2px dashed #b2ebf2; border-radius: 12px; 
    display: flex; align-items: center; justify-content: center; 
    overflow: hidden;
  }
  .number { position: absolute; top: 0; left: 50%; transform: translateX(-50%); font-size: 20px; font-weight: bold; color: #00838f; }

  /* æ§åˆ¶å€åŸŸ */
  .top-controls { margin-bottom: 15px; }
  .game-footer { margin-top: 25px; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; }
  
  button { padding: 10px 22px; font-size: 16px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.2s; }
  #toggleLayout { background: #546e7a; color: white; }
  #check { background: #00bfa5; color: white; }
  #retry { background: #ffa000; color: white; }
  #back { background: #b0bec5; color: white; }
  
  button:hover { filter: brightness(1.1); }
  .message { font-size: 22px; font-weight: bold; margin: 15px; min-height: 30px; }

  /* ç›®éŒ„é  */
  .menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px auto; }
  .story-btn {
    width: 150px; background: white; border-radius: 15px; padding: 10px; cursor: pointer;
  }
  .story-btn img { width: 100%; height: 100px; object-fit: cover; border-radius: 10px; }

  /* æ‰‹æ©Ÿè¢å¹•æ¥µçª„æ™‚çš„ç¸®å°è™•ç† */
  @media (max-width: 650px) {
    #source img, .slot { width: 85px; height: 80px; }
    .number { font-size: 16px; }
    .layout-stacked .panel { padding: 10px; }
  }
</style>
</head>
<body>

<h1>ç«¥è©±æ•…äº‹æ’åº</h1>

<div class="menu" id="menu"></div>

<div id="game" class="game-wrapper">
  <div class="top-controls">
    <button id="toggleLayout">ğŸ”„ åˆ‡æ›ä½ˆå±€ (ç›®å‰: å·¦å³ 2x2)</button>
  </div>
  
  <h2 id="story-name" style="color:#006064; margin-bottom: 15px;"></h2>
  
  <div id="gameMain" class="game-main layout-side-by-side">
    <div class="panel">
      <div class="panel-title">ğŸ–¼ï¸ æ•…äº‹ç¢ç‰‡</div>
      <div class="panel-tip" id="sourceTip">å¾å·¦å´æ‹–æ›³åœ–ç‰‡</div>
      <div id="source" class="grid-layout"></div>
    </div>

    <div class="panel">
      <div class="panel-title">ğŸ¯ æ’åºä½ç½®</div>
      <div class="panel-tip">æŒ‰æ­£ç¢ºé †åºæ”¾å…¥</div>
      <div class="grid-layout positions">
        <div class="slot-wrapper"><div class="number">1</div><div class="slot"></div></div>
        <div class="slot-wrapper"><div class="number">2</div><div class="slot"></div></div>
        <div class="slot-wrapper"><div class="number">3</div><div class="slot"></div></div>
        <div class="slot-wrapper"><div class="number">4</div><div class="slot"></div></div>
      </div>
    </div>
  </div>

  <div class="message" id="message"></div>
  <div class="game-footer">
    <button id="check">æª¢æŸ¥ç­”æ¡ˆ</button>
    <button id="retry">å†ç©ä¸€æ¬¡</button>
    <button id="back">è¿”å›æ¸…å–®</button>
  </div>
</div>

<script>
// éŸ³æ•ˆèˆ‡æ•…äº‹æ•¸æ“š
const sounds = {
  click: new Audio("audio/card-sounds-35956.mp3"),
  drop: new Audio("audio/card-sounds-35956.mp3"),
  return: new Audio("audio/card-sounds-35956.mp3"),
  success: new Audio("audio/Well Done CCBY3.ogg"),
  error: new Audio("audio/total fail.ogg")
};

const stories = {
  pigs: { name: "ä¸‰éš»å°è±¬", imgs: ["pigs0.jpg","pigs1.jpg","pigs2.jpg","pigs3.jpg","pigs4.jpg"], correct: [1,2,3,4] },
  redhood: { name: "å°ç´…å¸½", imgs: ["red0.jpg","red1.jpg","red2.jpg","red3.jpg","red4.jpg"], correct: [1,2,3,4] },
  bear: { name: "å°ç†Šæ‹”ç‰™", imgs: ["bear0.jpg","bear2.jpg","bear3.jpg","bear4.jpg"], correct: [1,2,3,4] },
  squirrel: { name: "æ¾é¼ éé¦¬è·¯", imgs: ["squirrel0.jpg","squirrel1.jpg","squirrel2.jpg","squirrel3.jpg","squirrel4.jpg"], correct: [1,2,3,4] },
  wolf: { name: "ç‹¼ä¾†äº†", imgs: ["wolf0.jpg","wolf1.jpg","wolf2.jpg","wolf3.jpg","wolf4.jpg"], correct: [1,2,3,4] },
  race: { name: "é¾œå…”è³½è·‘", imgs: ["race0.jpg","race1.jpg","race2.jpg","race3.jpg","race4.jpg"], correct: [1,2,3,4] },
  honey: { name: "ç†Šåˆ†äº«èœœç³–", imgs: ["honey0.jpg","honey1.jpg","honey2.jpg","honey3.jpg","honey4.jpg"], correct: [1,2,3,4] },
  crow: { name: "çƒé´‰å–æ°´", imgs: ["crow0.jpg","crow1.jpg","crow2.jpg","crow3.jpg","crow4.jpg"], correct: [1,2,3,4] },
  dog: { name: "è²ªå¿ƒçš„å°ç‹—", imgs: ["dog0.jpg","dog1.jpg","dog2.jpg","dog3.jpg","dog4.jpg"], correct: [1,2,3,4] }
};

let currentStory = null;

const gameMain = document.getElementById('gameMain');
const toggleBtn = document.getElementById('toggleLayout');
const sourceTip = document.getElementById('sourceTip');

toggleBtn.onclick = () => {
  if (gameMain.classList.contains('layout-side-by-side')) {
    gameMain.classList.replace('layout-side-by-side', 'layout-stacked');
    toggleBtn.textContent = "ğŸ”„ åˆ‡æ›ä½ˆå±€ (ç›®å‰: ä¸Šä¸‹æ‰“æ©«)";
    sourceTip.textContent = "å¾ä¸Šæ–¹æ‹–æ›³åœ–ç‰‡åˆ°ä¸‹æ–¹";
  } else {
    gameMain.classList.replace('layout-stacked', 'layout-side-by-side');
    toggleBtn.textContent = "ğŸ”„ åˆ‡æ›ä½ˆå±€ (ç›®å‰: å·¦å³ 2x2)";
    sourceTip.textContent = "å¾å·¦å´æ‹–æ›³åœ–ç‰‡åˆ°å³å´";
  }
  playSound('click');
};

function playSound(name) {
  if (sounds[name]) { sounds[name].currentTime = 0; sounds[name].play().catch(e => {}); }
}

function renderMenu() {
  const menu = document.getElementById('menu');
  menu.innerHTML = '';
  for (let key in stories) {
    const story = stories[key];
    const btn = document.createElement('div');
    btn.className = 'story-btn';
    btn.innerHTML = `<img src="${story.imgs[0]}"><span>${story.name}</span>`;
    btn.onclick = () => startGame(story);
    menu.appendChild(btn);
  }
}

function startGame(story) {
  currentStory = story;
  playSound('click');
  document.getElementById('menu').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  document.getElementById('story-name').textContent = story.name;
  document.getElementById('message').textContent = '';
  
  const indices = [1, 2, 3, 4];
  shuffle(indices);
  const source = document.getElementById('source');
  source.innerHTML = '';
  indices.forEach(i => {
    const img = document.createElement('img');
    img.src = story.imgs[i];
    img.draggable = true;
    img.dataset.index = i;
    img.addEventListener('dragstart', function() { this.classList.add('dragging'); });
    img.addEventListener('dragend', function() { this.classList.remove('dragging'); });
    source.appendChild(img);
  });
  document.querySelectorAll('.slot').forEach(slot => slot.innerHTML = '');
  setupEvents();
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function setupEvents() {
  document.querySelectorAll('#source img').forEach(img => {
    img.ondragstart = e => e.dataTransfer.setData('index', img.dataset.index);
  });

  document.querySelectorAll('.slot').forEach(slot => {
    slot.ondragover = e => e.preventDefault();
    slot.ondrop = e => {
      e.preventDefault();
      const newIndex = e.dataTransfer.getData('index');
      const draggedImg = document.querySelector(`#source img[data-index="${newIndex}"]`) ||
                         document.querySelector(`.slot img[data-index="${newIndex}"]`);
      
      if (draggedImg) {
        playSound('drop');
        const existingImg = slot.querySelector('img');
        if (existingImg && existingImg.dataset.index !== newIndex) {
            existingImg.draggable = true;
            existingImg.ondragstart = ev => ev.dataTransfer.setData('index', existingImg.dataset.index);
            document.getElementById('source').appendChild(existingImg);
        }
        slot.innerHTML = '';
        const newImg = draggedImg.cloneNode();
        newImg.dataset.index = newIndex;
        newImg.draggable = true;
        slot.appendChild(newImg);
        if (draggedImg.parentElement.id === 'source') draggedImg.remove();
      }
    };

    slot.onclick = function() {
      const img = this.querySelector('img');
      if (!img) return;
      playSound('return');
      const returnedImg = img.cloneNode();
      returnedImg.draggable = true;
      returnedImg.dataset.index = img.dataset.index;
      returnedImg.ondragstart = ev => ev.dataTransfer.setData('index', returnedImg.dataset.index);
      document.getElementById('source').appendChild(returnedImg);
      this.innerHTML = '';
    };
  });
}

document.getElementById('check').onclick = () => {
  const answer = [];
  let allFilled = true;
  document.querySelectorAll('.slot').forEach(slot => {
    const img = slot.querySelector('img');
    img ? answer.push(parseInt(img.dataset.index)) : allFilled = false;
  });
  if (!allFilled) { playSound('error'); showMessage('âš ï¸ é‚„æœ‰ç©ºæ ¼æ²’å¡«å®Œå–”ï¼', 'wrong'); return; }
  if (JSON.stringify(answer) === JSON.stringify(currentStory.correct)) {
    playSound('success'); showMessage('ğŸŒŸ æ£’æ¥µäº†ï¼é †åºæ­£ç¢ºï¼', 'correct');
  } else {
    playSound('error'); showMessage('âŒ é †åºä¸å°ï¼Œå†è©¦ä¸€æ¬¡ï¼', 'wrong');
  }
};

document.getElementById('retry').onclick = () => { if (currentStory) startGame(currentStory); };

document.getElementById('back').onclick = () => {
  playSound('click');
  document.getElementById('menu').style.display = 'flex';
  document.getElementById('game').style.display = 'none';
};

function showMessage(text, type) {
  const msg = document.getElementById('message');
  msg.textContent = text;
  msg.className = 'message ' + (type === 'correct' ? 'correct' : 'wrong');
}

renderMenu();
</script>
</body>
</html>